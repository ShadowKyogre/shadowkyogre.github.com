<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0"><channel><title>ShadowKyogre's GitHub (systemd)</title><link>/</link><description></description><language>en</language><lastBuildDate>Tue, 23 Sep 2014 07:56:23 GMT</lastBuildDate><generator>http://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>My Experiences with ninit [Part 1]</title><link>/posts/my-experiences-with-ninit-part-1/</link><dc:creator>ShadowKyogre</dc:creator><description>&lt;div&gt;&lt;p&gt;This post is a collection of notes of the process I went through to take out &lt;br&gt;
systemd for ninit. Pardon for the scarcity, but I'll revisit this with better descriptions.&lt;/p&gt;
&lt;h2 id="what-is-ninit"&gt;What IS ninit?&lt;/h2&gt;
&lt;h2 id="preparation"&gt;Preparation&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Install procps-ng-nosystemd&lt;/li&gt;
&lt;li&gt;Temporary symlink to systemd-udevd&lt;/li&gt;
&lt;li&gt;Install ninit&lt;/li&gt;
&lt;li&gt;Set up service directories. You can find a rough copy (though not perfectly &lt;br&gt;
synced) copy of my /etc/ninit dir &lt;a href="/posts/my-experiences-with-ninit-part-1/github.com/shadowkyogre/ninit-boot"&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Reboot&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="post-install"&gt;Post-install&lt;/h2&gt;
&lt;h3 id="eudev-systemdcompat"&gt;eudev{,-systemdcompat}&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;manually build eudev and eudev-systemdcompat&lt;/li&gt;
&lt;li&gt;Remove the symlink from preparations in systemd&lt;/li&gt;
&lt;li&gt;intall eudev and eudev-systemdcompat&lt;/li&gt;
&lt;li&gt;Reboot to test things&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="nsvc-o-haltreboot-vs-ninit-shutdown-or"&gt;nsvc -o {halt,reboot} vs ninit-shutdown -{o,r}&lt;/h3&gt;
&lt;p&gt;I recommend ninit-shutdown -{o,r} if you don't want to manually handle turning &lt;br&gt;
services off before doing shutdown preparations in the halt service. ninit-shutdown &lt;br&gt;
also assumes quite a few things about how a system should be cleaned up, so if you &lt;br&gt;
want more control, you're going to have to fiddle with the halt service to shutdown &lt;br&gt;
the services you want in the correct order before halting.&lt;/p&gt;
&lt;h3 id="optional-pretty-messages-for-every-section-started"&gt;Optional: pretty messages for every section started&lt;/h3&gt;
&lt;p&gt;[Edit]: Forgot to fill this section out. Basically, all that's needed for this is a &lt;br&gt;
setup file that echos out a simple message.&lt;/p&gt;
&lt;h3 id="depends-arent-really-depends-more-like-start-before"&gt;Depends aren't really "depends" - more like "start before"&lt;/h3&gt;
&lt;p&gt;Title says it all. ninit won't actually check if the services that a service depends &lt;br&gt;
on have finished executing with success &lt;del&gt;or are running&lt;/del&gt;. Just ran some tests in my &lt;br&gt;
test box. Didn't seem to restart dbus even when I had two things dependent on it. &lt;br&gt;
However, statement about whether something finishes with success is still valid.&lt;/p&gt;
&lt;p&gt;Some ways to work around this include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Specify the order daemons are started in like /etc/rc.conf, except with &lt;br&gt;
/etc/ninit/daemon/depends: Simple enough work around. Everything's also started &lt;br&gt;
in parallel like this.&lt;/li&gt;
&lt;li&gt;Patch ninit &lt;del&gt;to include a separate file for services (opt) that specifies true &lt;br&gt;
deps that're only run once OR modifies the depends of certain services once it's &lt;br&gt;
done running: Too complex, but could be done.&lt;/del&gt; to do something about the return &lt;br&gt;
code for one-run services.&lt;/li&gt;
&lt;li&gt;&lt;del&gt;Use setup, rsetup, or sys-rsetup to do the dependency checking for shared &lt;br&gt;
dependencies: One of the things that the ninit docs &lt;strong&gt;don't&lt;/strong&gt; tell you is that using &lt;br&gt;
nsvc as a synced or waited service is NOT a good idea (nor as a services that's in &lt;br&gt;
depends either). I really wouldn't recommend this because this makes things complex.&lt;/del&gt; &lt;br&gt;
Only applicable for one-run services.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="thoughts"&gt;Thoughts&lt;/h2&gt;
&lt;p&gt;ninit's good enough if you've got a static configuration that doesn't have too many depends &lt;br&gt;
that can be easily managed and that don't require too many static initializations. It also &lt;br&gt;
doesn't seem to keep track of exit codes for error spotting (since a service could fail, but &lt;br&gt;
report back as finished. This is especially bad in mounting cases unless you force the mount &lt;br&gt;
to be verbose or write a wrapper to do something on that error). However, it'll happily report &lt;br&gt;
if something failed to run if it was a continuous service. There also isn't much documentation &lt;br&gt;
on what the nsvc -L output indicates. I'll try to document these later.&lt;/p&gt;
&lt;p&gt;For true depends for one-time initializations, I'd recommend something else (at least until I can &lt;br&gt;
figure out how to patch the run helper in ninit to work around this). I'm thinking of maybe also &lt;br&gt;
trying out busybox init+(monit or perp), initng, OpenRC, or initscripts-fork. &lt;del&gt;Currently, I'm &lt;br&gt;
interested in trying monit (even though this'd probably be a little too big for my own needs) since &lt;br&gt;
it does this dependency checking on its own and provides some additional security features that can &lt;br&gt;
be coded (eg: stop running a compromised service). The only thing that scares me about it is that it &lt;br&gt;
prefers pid files instead of being a direct parent of the process (as evidenced by with matching|pidfile &lt;br&gt;
when asking what to check for a pid). I just need to figure out which init system to run it from before &lt;br&gt;
I start trying it out.&lt;/del&gt;&lt;/p&gt;
&lt;h2 id="resources"&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.linuxfromscratch.org/pipermail/blfs-support/2004-March/049009.html"&gt;http://www.linuxfromscratch.org/pipermail/blfs-support/2004-March/049009.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ShadowKyogre/ninit-boot"&gt;https://github.com/ShadowKyogre/ninit-boot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ShadowKyogre/systemd-unit-converter"&gt;https://github.com/ShadowKyogre/systemd-unit-converter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</description><category>eudev</category><category>ninit</category><category>systemd</category><guid>/posts/my-experiences-with-ninit-part-1/</guid><pubDate>Thu, 18 Sep 2014 13:13:15 GMT</pubDate></item></channel></rss>